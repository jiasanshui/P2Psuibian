<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>

    <script type="text/javascript" src="../js/vue.js"></script>
    <script type="text/javascript" src="../js/axios.min.js"></script>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
</head>
<body>
<div class="diva">
    <el-container>
        <el-header>Header</el-header>
        <el-container>
            <el-aside width="200px">
                <el-tree
                        :data="treeData"
                        accordion
                        @node-click="handleNodeClick"
                        :icon-class="icon"
                >
                </el-tree>
            </el-aside>
            <el-container>
                <el-main height="400px">
                    <el-tabs v-model="editableTabsValue2" type="card" closable @tab-remove="removeTab">
                        <el-tab-pane
                                v-for="(item, index) in editableTabs2"
                                :key="item.name"
                                :label="item.title"
                                :name="item.name"
                        >
                            <iframe :src="item.url" style="width:100%;height:600px;"></iframe>
                        </el-tab-pane>
                    </el-tabs>
                </el-main>
                <el-footer>Footer</el-footer>
            </el-container>
        </el-container>
    </el-container>
</div>
<script>
    var vm = new Vue({
        el:".diva",
        data:{
            treeData:[],
            editableTabsValue2: '2',
            editableTabs2: [{
                title: '默认页',
                name: '2',
                url: 'https://www.baidu.com'
            }],
            tabIndex: 2
        },
        created:function(){
            var _self = this;
            axios.post("/tree/list").then(function(response){
                _self.treeData = response.data;
            })
        },
        methods:{
            handleNodeClick: function (n) {
                if(n.url!=null&&n.url!=''){
                    this.addTab(n.label,n.url);
                }
            },
            addTab: function (targetName,url) {
                var newTabName = targetName;
                if(JSON.stringify(this.editableTabs2).indexOf(targetName)==-1){
                    this.editableTabs2.push({
                        title:newTabName,
                        name: newTabName,
                        url: url
                    });
                }
                this.editableTabsValue2 = newTabName;
            },
            removeTab: function (targetName) {
                var tabs = this.editableTabs2;
                var activeName = this.editableTabsValue2;
                if (activeName === targetName) {
                    tabs.forEach((tab, index) => {
                        if (tab.name === targetName) {
                        var nextTab = tabs[index + 1] || tabs[index - 1];
                        if (nextTab) {
                            activeName = nextTab.name;
                        }
                    }
                });
                }
                this.editableTabsValue2 = activeName;
                this.editableTabs2 = tabs.filter(tab => tab.name !== targetName);
            }
        }
    })

</script>
<style>
    .el-header, .el-footer {
        background-color: #B3C0D1;
        color: #333;
        text-align: center;
        line-height: 60px;
    }

    .el-aside {
        background-color: #D3DCE6;
        color: #333;
        text-align: center;
        line-height: 200px;
    }

    .el-main {
        background-color: #E9EEF3;
        color: #333;
        text-align: center;
    }
</style>
</body>
</html>